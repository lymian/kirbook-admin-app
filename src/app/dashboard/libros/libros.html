<div class="container-fluid py-4">
  <h2 class="mb-4">
    <i class="bi bi-journal-bookmark-fill me-2"></i> Gestión de Libros
  </h2>

  <div class="mb-4 d-flex justify-content-start">
    <a routerLink="/dashboard/libros/registrar" class="btn btn-success">
      <i class="bi bi-plus-circle-fill me-1"></i> Registrar Nuevo Libro
    </a>
  </div>

  <div class="card bg-dark border-secondary">
    <div class="card-header border-secondary">
      <h5 class="mb-0 text-white"><i class="bi bi-list-ul me-2"></i> Listado de Libros</h5>
    </div>
    <div class="card-body">
      @if (cargando) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando libros...</span>
        </div>
        <p class="mt-2">Cargando libros...</p>
      </div>
      } @else {
      <div class="table-responsive">
        <table class="table table-dark table-striped table-hover align-middle">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Título</th>
              <th scope="col">Autor</th>
              <th scope="col">Categoría</th>
              <th scope="col" class="text-end">Precio</th>
              <th scope="col" class="text-end">Descuento</th>
              <th scope="col" class="text-center">Stock</th>
              <th scope="col" class="text-center">Estado</th>
              <th scope="col" class="text-center">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let libro of libros">
              <th scope="row">{{ libro.id }}</th>
              <td>{{ libro.titulo }}</td>
              <td>{{ libro.autorNombre }}</td>
              <td>
                <span class="badge bg-info text-dark">{{ libro.categoriaNombre }}</span>
              </td>
              <td class="text-end fw-bold">S/ {{ libro.precio | number : '1.2-2' }}</td>
              <td class="text-end fw-bold">
                <span *ngIf="libro.descuento > 0" class="text-danger">-{{ libro.descuento | number : '1.0-0' }}%</span>
                <span *ngIf="!libro.descuento || libro.descuento === 0" class="text-muted">-</span>
              </td>
              <td class="text-center">
                <span class="badge {{
                    libro.stock > 10
                      ? 'bg-success'
                      : libro.stock > 0
                      ? 'bg-warning text-dark'
                      : 'bg-danger'
                  }}">
                  {{ libro.stock }}
                </span>
              </td>

              <td class="text-center">
                <span class="badge {{ libro.estado ? 'bg-success' : 'bg-danger' }}">
                  {{ libro.estado ? 'Activo' : 'Inactivo' }}
                </span>
              </td>

              <td class="text-center text-nowrap">
                <a [routerLink]="['/dashboard/libros/editar', libro.id]" class="btn btn-warning btn-sm me-2"
                  title="Editar Libro">
                  <i class="bi bi-pencil-square"></i>
                </a>

                <button (click)="confirmarEstado(libro)" class="btn btn-secondary btn-sm" title="Cambiar Estado">
                  <i class="bi bi-toggle-on"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <nav *ngIf="totalPages > 1" aria-label="Navegación de páginas" class="mt-4">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="first">
            <button class="page-link bg-dark text-white border-secondary" (click)="cambiarPagina(page - 1)"
              [disabled]="first">
              <span aria-hidden="true">&laquo;</span>
            </button>
          </li>

          <li class="page-item" *ngFor="let p of pagesArray" [class.active]="p === page">
            <button class="page-link bg-dark text-white border-secondary" (click)="cambiarPagina(p)">
              {{ p + 1 }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="last">
            <button class="page-link bg-dark text-white border-secondary" (click)="cambiarPagina(page + 1)"
              [disabled]="last">
              <span aria-hidden="true">&raquo;</span>
            </button>
          </li>
        </ul>
      </nav>
      }
    </div>
  </div>
</div>

<div class="modal d-block" tabindex="-1" *ngIf="modalConfirmar" style="background-color: rgba(0, 0, 0, 0.5)">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-bg-dark border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title text-warning">
          <i class="bi bi-question-circle-fill me-2"></i> Confirmar Acción
        </h5>
        <button type="button" class="btn-close btn-close-white" aria-label="Close"
          (click)="cancelarConfirmar()"></button>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro de que deseas cambiar el estado de este libro (Activo/Inactivo)?</p>
      </div>
      <div class="modal-footer border-secondary">
        <button type="button" class="btn btn-secondary" (click)="cancelarConfirmar()">
          <i class="bi bi-x-circle me-1"></i> Cancelar
        </button>
        <button type="button" class="btn btn-warning" (click)="cambiarEstadoConfirmado()">
          <i class="bi bi-arrow-repeat me-1"></i> Continuar
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal d-block" tabindex="-1" *ngIf="modalError" style="background-color: rgba(0, 0, 0, 0.5)">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-bg-dark border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title text-danger"><i class="bi bi-x-octagon-fill me-2"></i> Error</h5>
        <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modalError = ''"></button>
      </div>
      <div class="modal-body">
        <p>{{ modalError }}</p>
      </div>
      <div class="modal-footer border-secondary">
        <button type="button" class="btn btn-danger" (click)="modalError = ''">
          <i class="bi bi-check-circle me-1"></i> Aceptar
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal d-block" tabindex="-1" *ngIf="modalExito" style="background-color: rgba(0, 0, 0, 0.5)">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-bg-dark border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title text-success"><i class="bi bi-check-circle-fill me-2"></i> Éxito</h5>
        <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modalExito = ''"></button>
      </div>
      <div class="modal-body">
        <p>{{ modalExito }}</p>
      </div>
      <div class="modal-footer border-secondary">
        <button type="button" class="btn btn-success" (click)="modalExito = ''">
          <i class="bi bi-check-circle me-1"></i> Aceptar
        </button>
      </div>
    </div>
  </div>
</div>